<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>caubdns</title>
		<style>
			* {
				background-color: black;
				color: rgb(196, 196, 196);
			}
			body {
				background-color: black;
				font-family: monospace;
				font-size: 15px;
				margin: 35px;
				margin-top:5px;
			}

			a {
				color: cyan
			}
			input,button {
				background-color: #131313;
				border:#0a0a0a ;
				border-width: 3px;
				border-radius: 3px;
				border-style:solid;
				margin: 1.4px;
				cursor: pointer;
			}

			.list {
				line-height: 2
			}

			.border {
				border: 2px solid white;
				padding: 10px
			}
			.wrapper {
				margin: 0 auto;
			}
			.block1 {
  		 	 	float:left;
			}

			.block2{
    			float:right;
			}

code{
	background-color: #131313;
	border-radius: 5px;
	color: rgb(168, 92, 255);
}

	
		</style>
	</head>
	<body>
	<div class="wrapper">
		<div class="block1">
		<h1>caubdns editor</h1>
		<input id="meteredToggle" type="checkbox" checked>enable metered (update blocker)</input>
		<br>
		<input id="dnsEnabled" type="checkbox">edit dns</input> <code>(OmadaDNS on the side)</code>
		<br>
		<input type="text" id="dns1" placeholder="Enter IP..." /> <code>(167.86.91.171)</code>
		<br>
		<input type="text" id="dns2" placeholder="Enter IP..." /> <code>(66.94.105.229)</code>
		<br>
		<input type="text" id="dns3" placeholder="Enter IP..." /> <code>(213.109.163.210)</code>
		<br>
		<input type="text" id="dns4" placeholder="Enter IP..." /> <code>(92.60.37.102)</code>
		<br>
		<br>

		<input id="proxyEnabled" type="checkbox">edit proxy</input>
		<br>
		<br>
		ftp proxy <input  type="text" id="ftpProxy" placeholder="socks4://localhost" /><input value="1080" type="number" id="ftpProxyPort"></input>
		<br>
		HTTP proxy <input type="text" id="httpProxy" placeholder="socks4://localhost" /><input value="1080" type="number" id="httpProxyPort"></input>
		<br>
		secure HTTPS proxy <input type="text" id="secureHttpProxy" placeholder="socks4://localhost" /><input value="1080" type="number" id="secureHttpProxyPort"></input>
		<br>
		socks host <input type="text" id="socks" placeholder="localhost" /><input value="1080" type="number" id="socksProxyPort"></input>
		<br>
		domains to exclude as json array <input type="text" value="[]" id="excludeDomains" />
		<br>
		example:
		<code style="margin-bottom: 60px;">["*.com", "google.com"]</code>
	</div>

		<div class="block2">
<h1>
		<h1>Instructions</h1>

		<div class="list">
			1. Edit the settings above<br>
			2. Go to <code>chrome://network#state</code><br>
			3. Scroll to <code>"Favourite Networks"</code><br>
			4. Find the wifi network that you are currently connected to<br>
			5. Click the <code>+</code> next to the wifi name<br>
			6. Copy all the data that appears (the <code>{}</code> curly braces)<br>
			7. Paste the data into the box below and press the generate button<br>
		</div>
		<br>
		<input class="inputData" placeholder="read instructions" />
		<div id="extraInputs"></div>
		<button onclick="addInput()">+</button>
		<button onclick="removeInput()">-</button>
		<br>
		<button onclick="gen()" style="margin-bottom: 60px; color: rgb(68, 255, 183);">Gen and Download ONC file</button>
		<br>
	</div>
</div>
<div class="block3">
	<h1>â€Ž </h1>
	<br>
<h1 style="margin-top: 370px;">Importing the ONC file</h1>
<div class="list">
	Once you have downloaded the file, go to <code>chrome://network#general</code><br>
	Scroll to the bottom and click <code>"Import ONC"</code><br>
	Open the downloaded file, it should say <code>"Networks imported: 1"</code><br>
	Your network should be configured now.
</div>
</div>
		<script>
			let extraInputs = document.querySelector("#extraInputs")
			function addInput(){
				extraInputs.innerHTML += `<input type="text" class="inputData" />`
			}

			function removeInput(){
				if(extraInputs.lastChild) extraInputs.lastChild.remove()
			}

			function gen() {
				let inputDataElements = document.querySelectorAll(".inputData")
				let onc = { Type: "UnencryptedConfiguration", NetworkConfigurations: [] };
				inputDataElements.forEach(inputDataElement => {
					try {
						let network = JSON.parse(inputDataElement.value);
						if (!network.GUID || !network.Name || !network.WiFi) throw new Error();
						let configuration = {
							GUID: network.GUID,
							Metered: document.querySelector("#meteredToggle").checked,
							Name: network.Name,
							Type: "WiFi",
							WiFi: {
								AutoConnect: true,
								SSID: network.Name,
								Security: "None",
							},
						}

						if(document.querySelector("#dnsEnabled").checked){
							let nameServers = [];
							["#dns1", "#dns2", "#dns3", "#dns4"].forEach(dnsSelector => {
								let element = document.querySelector(dnsSelector)
								nameServers.push(element.value === "" ? "0.0.0.0" : element.value)
							})

							configuration.NameServersConfigType = "Static"
							configuration.StaticIPConfig = {
								NameServers: nameServers 
							}
						} else {
							configuration.NameServersConfigType = "DHCP"
						}

						if(document.querySelector("#proxyEnabled").checked){
							//parse json
							//return error if failed
							let parsedExcludeList
							try {
								parsedExcludeList = JSON.parse(document.querySelector("#excludeDomains").value)
							} catch (e){
								alert("failed to parse exclude domains list for proxy")
							}
							if(parsedExcludeList === undefined){
								throw new Error()
							}

							configuration.ProxySettings = {
								ExcludeDomains: parsedExcludeList,
								Manual: {
									FTPProxy: {
										Host: document.querySelector("#ftpProxy").value,
										Port: parseInt(document.querySelector("#ftpProxyPort").value)
									},
									HTTPProxy: {
										Host: document.querySelector("#httpProxy").value,
										Port: parseInt(document.querySelector("#httpProxyPort").value)
									},
									SOCKS: {
										Host: document.querySelector("#socks").value,
										Port: parseInt(document.querySelector("#socksProxyPort").value)
									},
									SecureHTTPProxy: {
										Host: document.querySelector("#secureHttpProxy").value,
										Port: parseInt(document.querySelector("#secureHttpProxyPort").value)
									}
								},
								Type: "Manual"
							}
						} else {
							configuration.ProxySettings = {
								Type: "Direct"
							}
						}

						onc.NetworkConfigurations.push(configuration);
						inputDataElement.style.borderColor = "lime";
					} catch (error) {
						console.error(error);
						inputDataElement.style.borderColor = "red";
					}
				})
				if (onc.NetworkConfigurations[0]) download(onc);
			}

			function download(object, fileName) {
				let link = document.createElement("a");
				link.href = URL.createObjectURL(new Blob([JSON.stringify(object)]));
				link.download = fileName || "network.onc";
				link.click().remove();
			}
		</script>
	</body>
</html>